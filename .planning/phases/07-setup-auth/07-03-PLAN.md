---
phase: 07-setup-auth
plan: 03
type: execute
wave: 2
depends_on: ["07-01", "07-02"]
files_modified:
  - web/src/App.tsx
  - web/src/main.tsx
  - web/src/pages/LoginPage.tsx
  - web/src/pages/DashboardPage.tsx
  - web/src/components/ProtectedRoute.tsx
  - web/src/components/ui/input.tsx
  - web/src/components/ui/label.tsx
  - web/src/components/ui/card.tsx
autonomous: true
must_haves:
  truths:
    - "User can access /login page"
    - "User can enter email and password"
    - "Valid credentials redirect to /dashboard"
    - "Invalid credentials show error message"
    - "Session persists after page refresh"
    - "Logout clears session and redirects to /login"
    - "Unauthenticated users are redirected from /dashboard to /login"
  artifacts:
    - path: "web/src/pages/LoginPage.tsx"
      provides: "Login form with email/password fields"
      contains: "handleSubmit"
    - path: "web/src/components/ProtectedRoute.tsx"
      provides: "Route wrapper that requires auth"
      contains: "useAuth"
    - path: "web/src/App.tsx"
      provides: "Router with protected and public routes"
      contains: "BrowserRouter"
  key_links:
    - from: "web/src/pages/LoginPage.tsx"
      to: "web/src/hooks/useAuth.ts"
      via: "login function call"
      pattern: "useAuth.*login"
    - from: "web/src/components/ProtectedRoute.tsx"
      to: "web/src/hooks/useAuth.ts"
      via: "isAuthenticated check"
      pattern: "useAuth.*isAuthenticated"
    - from: "web/src/App.tsx"
      to: "web/src/contexts/AuthContext.tsx"
      via: "AuthProvider wrapper"
      pattern: "AuthProvider"
---

<objective>
Create the login page UI and protected route system.

Purpose: Enable users to authenticate and protect dashboard routes from unauthenticated access.
Output: Working login flow with form, error handling, and route protection.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

Dependencies from previous plans:
- 07-01: Vite + React + Tailwind + shadcn/ui setup
- 07-02: AuthContext, useAuth hook, api client

This plan depends on both 07-01 and 07-02 completing first.

React Router will be installed for routing.
Additional shadcn components (Input, Label, Card) will be added for the form.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shadcn/ui form components and React Router</name>
  <files>web/src/components/ui/input.tsx, web/src/components/ui/label.tsx, web/src/components/ui/card.tsx</files>
  <action>
    Install dependencies and add shadcn components needed for login form.

    1. Install React Router:
       `cd web && npm install react-router-dom`

    2. Add shadcn/ui form components:
       ```bash
       cd web
       npx shadcn@latest add input
       npx shadcn@latest add label
       npx shadcn@latest add card
       npx shadcn@latest add alert
       ```

    These commands will create:
    - src/components/ui/input.tsx
    - src/components/ui/label.tsx
    - src/components/ui/card.tsx
    - src/components/ui/alert.tsx

    If any command fails, manually create the components from shadcn docs.
  </action>
  <verify>Files exist: ls web/src/components/ui/ shows input.tsx, label.tsx, card.tsx, alert.tsx</verify>
  <done>Form components and React Router installed</done>
</task>

<task type="auto">
  <name>Task 2: Create LoginPage component</name>
  <files>web/src/pages/LoginPage.tsx</files>
  <action>
    Create login page with form, validation, and error handling.

    Create web/src/pages/LoginPage.tsx:
    ```typescript
    import { useState, type FormEvent } from 'react'
    import { useNavigate, Link } from 'react-router-dom'
    import { useAuth } from '@/hooks/useAuth'
    import { Button } from '@/components/ui/button'
    import { Input } from '@/components/ui/input'
    import { Label } from '@/components/ui/label'
    import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card'
    import { Alert, AlertDescription } from '@/components/ui/alert'
    import { AlertCircle, Loader2 } from 'lucide-react'

    export function LoginPage() {
      const navigate = useNavigate()
      const { login } = useAuth()

      const [email, setEmail] = useState('')
      const [password, setPassword] = useState('')
      const [error, setError] = useState<string | null>(null)
      const [isLoading, setIsLoading] = useState(false)

      async function handleSubmit(e: FormEvent) {
        e.preventDefault()
        setError(null)
        setIsLoading(true)

        try {
          await login({ email, password })
          navigate('/dashboard')
        } catch (err) {
          setError(err instanceof Error ? err.message : 'Login failed')
        } finally {
          setIsLoading(false)
        }
      }

      return (
        <div className="min-h-screen flex items-center justify-center bg-background p-4">
          <Card className="w-full max-w-md">
            <CardHeader className="space-y-1">
              <CardTitle className="text-2xl font-bold">Sign in</CardTitle>
              <CardDescription>
                Enter your credentials to access AuditEng
              </CardDescription>
            </CardHeader>
            <form onSubmit={handleSubmit}>
              <CardContent className="space-y-4">
                {error && (
                  <Alert variant="destructive">
                    <AlertCircle className="h-4 w-4" />
                    <AlertDescription>{error}</AlertDescription>
                  </Alert>
                )}
                <div className="space-y-2">
                  <Label htmlFor="email">Email</Label>
                  <Input
                    id="email"
                    type="email"
                    placeholder="engineer@company.com"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    required
                    disabled={isLoading}
                    autoComplete="email"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="password">Password</Label>
                  <Input
                    id="password"
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    required
                    disabled={isLoading}
                    autoComplete="current-password"
                  />
                </div>
              </CardContent>
              <CardFooter className="flex flex-col space-y-4">
                <Button type="submit" className="w-full" disabled={isLoading}>
                  {isLoading ? (
                    <>
                      <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                      Signing in...
                    </>
                  ) : (
                    'Sign in'
                  )}
                </Button>
                <p className="text-sm text-muted-foreground text-center">
                  Don't have an account?{' '}
                  <Link to="/register" className="text-primary underline-offset-4 hover:underline">
                    Register
                  </Link>
                </p>
              </CardFooter>
            </form>
          </Card>
        </div>
      )
    }
    ```

    Create web/src/pages/index.ts:
    ```typescript
    export { LoginPage } from './LoginPage'
    ```
  </action>
  <verify>TypeScript compiles: cd web && npx tsc --noEmit</verify>
  <done>Login page with form, loading state, and error display</done>
</task>

<task type="auto">
  <name>Task 3: Create ProtectedRoute and DashboardPage</name>
  <files>web/src/components/ProtectedRoute.tsx, web/src/pages/DashboardPage.tsx</files>
  <action>
    Create route protection wrapper and placeholder dashboard.

    1. Create web/src/components/ProtectedRoute.tsx:
       ```typescript
       import { Navigate, useLocation } from 'react-router-dom'
       import { useAuth } from '@/hooks/useAuth'
       import { Loader2 } from 'lucide-react'

       interface ProtectedRouteProps {
         children: React.ReactNode
       }

       export function ProtectedRoute({ children }: ProtectedRouteProps) {
         const { isAuthenticated, isLoading } = useAuth()
         const location = useLocation()

         // Show loading while checking auth state
         if (isLoading) {
           return (
             <div className="min-h-screen flex items-center justify-center">
               <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
             </div>
           )
         }

         // Redirect to login if not authenticated
         if (!isAuthenticated) {
           return <Navigate to="/login" state={{ from: location }} replace />
         }

         return <>{children}</>
       }
       ```

    2. Create web/src/pages/DashboardPage.tsx (placeholder for now):
       ```typescript
       import { useAuth } from '@/hooks/useAuth'
       import { Button } from '@/components/ui/button'
       import { LogOut } from 'lucide-react'

       export function DashboardPage() {
         const { user, logout } = useAuth()

         return (
           <div className="min-h-screen bg-background">
             <header className="border-b">
               <div className="container mx-auto px-4 py-4 flex items-center justify-between">
                 <h1 className="text-xl font-semibold">AuditEng Dashboard</h1>
                 <div className="flex items-center gap-4">
                   <span className="text-sm text-muted-foreground">{user?.email}</span>
                   <Button variant="outline" size="sm" onClick={logout}>
                     <LogOut className="h-4 w-4 mr-2" />
                     Logout
                   </Button>
                 </div>
               </div>
             </header>
             <main className="container mx-auto px-4 py-8">
               <div className="rounded-lg border bg-card p-8 text-center">
                 <h2 className="text-2xl font-bold mb-2">Welcome to AuditEng</h2>
                 <p className="text-muted-foreground">
                   Dashboard content will be implemented in Phase 10.
                 </p>
               </div>
             </main>
           </div>
         )
       }
       ```

    3. Update web/src/pages/index.ts:
       ```typescript
       export { LoginPage } from './LoginPage'
       export { DashboardPage } from './DashboardPage'
       ```
  </action>
  <verify>TypeScript compiles: cd web && npx tsc --noEmit</verify>
  <done>ProtectedRoute wrapper and placeholder DashboardPage created</done>
</task>

<task type="auto">
  <name>Task 4: Wire up App with Router and AuthProvider</name>
  <files>web/src/App.tsx, web/src/main.tsx</files>
  <action>
    Connect everything: Router, AuthProvider, routes.

    1. Update web/src/main.tsx to add BrowserRouter:
       ```typescript
       import { StrictMode } from 'react'
       import { createRoot } from 'react-dom/client'
       import { BrowserRouter } from 'react-router-dom'
       import { AuthProvider } from '@/contexts/AuthContext'
       import App from './App'
       import './index.css'

       createRoot(document.getElementById('root')!).render(
         <StrictMode>
           <BrowserRouter>
             <AuthProvider>
               <App />
             </AuthProvider>
           </BrowserRouter>
         </StrictMode>
       )
       ```

    2. Update web/src/App.tsx with routes:
       ```typescript
       import { Routes, Route, Navigate } from 'react-router-dom'
       import { LoginPage, DashboardPage } from '@/pages'
       import { ProtectedRoute } from '@/components/ProtectedRoute'

       function App() {
         return (
           <Routes>
             {/* Public routes */}
             <Route path="/login" element={<LoginPage />} />

             {/* Protected routes */}
             <Route
               path="/dashboard"
               element={
                 <ProtectedRoute>
                   <DashboardPage />
                 </ProtectedRoute>
               }
             />

             {/* Default redirect */}
             <Route path="/" element={<Navigate to="/dashboard" replace />} />

             {/* Catch all - redirect to dashboard (will bounce to login if not auth) */}
             <Route path="*" element={<Navigate to="/dashboard" replace />} />
           </Routes>
         )
       }

       export default App
       ```

    3. Verify the flow:
       - / redirects to /dashboard
       - /dashboard requires auth, redirects to /login if not authenticated
       - /login shows login form
       - Successful login redirects to /dashboard
       - Logout clears session, redirects to /login
  </action>
  <verify>cd web && npm run dev -- open the app, verify /login shows form, protected routes redirect</verify>
  <done>Full auth flow wired up with React Router</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run dev` starts without errors
- [ ] `cd web && npm run build` completes without errors
- [ ] Navigate to / redirects to /login (when not authenticated)
- [ ] Login form renders with email/password fields
- [ ] Invalid credentials show error message
- [ ] Logout button clears session and redirects to /login
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Auth flow works end-to-end (manual test without backend is ok - errors expected)
- Protected routes redirect unauthenticated users
</success_criteria>

<output>
After completion, create `.planning/phases/07-setup-auth/07-03-SUMMARY.md`
</output>
