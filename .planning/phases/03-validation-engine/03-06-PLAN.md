---
phase: 03-validation-engine
plan: 06
type: execute
wave: 3
depends_on: [03-02, 03-03, 03-04, 03-05]
files_modified: [app/core/validation/__init__.py, app/core/validation/orchestrator.py]
autonomous: true

must_haves:
  truths:
    - "Equipment-type-specific thresholds applied correctly"
    - "Single entry point orchestrates all validators"
    - "Validation results combined from all applicable validators"
  artifacts:
    - path: "app/core/validation/orchestrator.py"
      provides: "ValidationOrchestrator class"
      exports: ["ValidationOrchestrator", "validate_extraction"]
  key_links:
    - from: "orchestrator.py"
      to: "grounding.py, megger.py, thermography.py"
      via: "delegates to test-type validators"
    - from: "orchestrator.py"
      to: "calibration.py, cross_field.py"
      via: "applies common validators"
---

<objective>
Create orchestrator that applies equipment-type-specific validation.

Purpose: Coordinate all validators and apply equipment-specific rules (VALD-09).
Output: ValidationOrchestrator that combines all validation results.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-validation-engine/03-01-SUMMARY.md

Requirements this plan addresses:
- VALD-09: System validates against equipment-type-specific thresholds (PANEL, UPS, ATS, GEN, XFMR)

Equipment types from app/schemas/enums.py:
- PANEL, UPS, ATS, GEN, XFMR

All validators to orchestrate:
- GroundingValidator, MeggerValidator, ThermographyValidator
- CalibrationValidator, CrossFieldValidator
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ValidationOrchestrator</name>
  <files>app/core/validation/orchestrator.py</files>
  <action>
Create orchestrator that coordinates all validators.

app/core/validation/orchestrator.py:
- Import all validators
- Import from app.core.extraction.schemas import BaseExtractionResult
- Import from app.core.extraction.grounding import GroundingExtractionResult
- Import from app.core.extraction.megger import MeggerExtractionResult
- Import from app.core.extraction.thermography import ThermographyExtractionResult

class ValidationOrchestrator:
    """Orchestrates validation across all validators.

    Coordinates test-type-specific validators with common validators
    to produce a complete validation result.
    """

    def __init__(self, config: ValidationConfig | None = None):
        self.config = config or get_validation_config()
        self.grounding_validator = GroundingValidator(self.config)
        self.megger_validator = MeggerValidator(self.config)
        self.thermography_validator = ThermographyValidator(self.config)
        self.calibration_validator = CalibrationValidator(self.config)
        self.cross_field_validator = CrossFieldValidator(self.config)

    def validate(self, extraction: BaseExtractionResult) -> ValidationResult:
        """Validate extraction using appropriate validators.

        Args:
            extraction: The extraction result to validate.

        Returns:
            ValidationResult with all findings combined.
        """
        all_findings: list[Finding] = []
        test_type = "unknown"
        equipment_tag = None

        # Determine test type and get equipment tag
        if isinstance(extraction, GroundingExtractionResult):
            test_type = "grounding"
            result = self.grounding_validator.validate(extraction)
            all_findings.extend(result.findings)
            equipment_tag = result.equipment_tag
        elif isinstance(extraction, MeggerExtractionResult):
            test_type = "megger"
            result = self.megger_validator.validate(extraction)
            all_findings.extend(result.findings)
            equipment_tag = result.equipment_tag
        elif isinstance(extraction, ThermographyExtractionResult):
            test_type = "thermography"
            result = self.thermography_validator.validate(extraction)
            all_findings.extend(result.findings)
            equipment_tag = result.equipment_tag

        # Apply calibration validation
        calib_result = self.calibration_validator.validate(extraction)
        all_findings.extend(calib_result.findings)

        # Apply cross-field validation
        cross_result = self.cross_field_validator.validate(extraction)
        all_findings.extend(cross_result.findings)

        return ValidationResult(
            test_type=test_type,
            equipment_tag=equipment_tag,
            findings=all_findings,
        )


def validate_extraction(extraction: BaseExtractionResult) -> ValidationResult:
    """Convenience function to validate an extraction.

    Args:
        extraction: The extraction result to validate.

    Returns:
        ValidationResult with all findings.
    """
    orchestrator = ValidationOrchestrator()
    return orchestrator.validate(extraction)
  </action>
  <verify>python3 -c "from app.core.validation.orchestrator import ValidationOrchestrator, validate_extraction; print('✓ Orchestrator imports')"</verify>
  <done>ValidationOrchestrator coordinates all validators</done>
</task>

<task type="auto">
  <name>Task 2: Update validation __init__.py</name>
  <files>app/core/validation/__init__.py</files>
  <action>
Update module exports to include all validators.

Add to app/core/validation/__init__.py:
- Import and export GroundingValidator
- Import and export MeggerValidator
- Import and export ThermographyValidator
- Import and export CalibrationValidator
- Import and export CrossFieldValidator
- Import and export ValidationOrchestrator
- Import and export validate_extraction
  </action>
  <verify>python3 -c "from app.core.validation import validate_extraction, ValidationOrchestrator; print('✓ All exports available')"</verify>
  <done>All validators exported from validation module</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ValidationOrchestrator coordinates all validators
- [ ] validate_extraction() convenience function works
- [ ] Equipment-type thresholds applied via GroundingValidator
- [ ] All validators exported from __init__.py
</verification>

<success_criteria>
- All tasks completed
- VALD-09 requirements addressed
- Complete validation pipeline functional
</success_criteria>

<output>
After completion, create `.planning/phases/03-validation-engine/03-06-SUMMARY.md`
</output>
