---
phase: 08-layout-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/components/layout/MainLayout.tsx
  - web/src/components/layout/Sidebar.tsx
  - web/src/components/layout/Header.tsx
  - web/src/components/layout/UserDropdown.tsx
  - web/src/components/layout/Breadcrumbs.tsx
  - web/src/components/layout/index.ts
  - web/src/components/ui/dropdown-menu.tsx
  - web/src/components/ui/avatar.tsx
  - web/src/components/ui/separator.tsx
  - web/src/App.tsx
  - web/package.json
autonomous: true

must_haves:
  truths:
    - "User sees sidebar navigation after login"
    - "User can navigate between pages using sidebar links"
    - "User can see their email and logout from user dropdown"
    - "User sees breadcrumbs showing current location"
    - "Sidebar collapses on mobile viewports"
  artifacts:
    - path: "web/src/components/layout/MainLayout.tsx"
      provides: "App shell with sidebar + header + content area"
      min_lines: 30
    - path: "web/src/components/layout/Sidebar.tsx"
      provides: "Navigation sidebar with links"
      contains: "NavLink"
    - path: "web/src/components/layout/UserDropdown.tsx"
      provides: "User menu with email and logout"
      contains: "logout"
    - path: "web/src/components/layout/Breadcrumbs.tsx"
      provides: "Breadcrumb navigation"
      contains: "useLocation"
  key_links:
    - from: "web/src/App.tsx"
      to: "web/src/components/layout/MainLayout.tsx"
      via: "MainLayout wraps protected routes"
      pattern: "<MainLayout>"
    - from: "web/src/components/layout/Sidebar.tsx"
      to: "react-router-dom"
      via: "NavLink for navigation"
      pattern: "NavLink.*to="
    - from: "web/src/components/layout/UserDropdown.tsx"
      to: "web/src/hooks/useAuth.ts"
      via: "useAuth hook for user and logout"
      pattern: "useAuth\\(\\)"
---

<objective>
Create the application shell with sidebar navigation, header, user dropdown, and breadcrumbs.

Purpose: Establish consistent layout structure that wraps all protected pages, providing navigation and user context.
Output: MainLayout component that wraps protected routes with sidebar, header, and breadcrumbs.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v2.0-ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-setup-auth/07-03-SUMMARY.md

# Existing files to understand:
@web/src/App.tsx
@web/src/pages/DashboardPage.tsx
@web/src/hooks/useAuth.ts
@web/src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shadcn dropdown and avatar components</name>
  <files>web/src/components/ui/dropdown-menu.tsx, web/src/components/ui/avatar.tsx, web/src/components/ui/separator.tsx, web/package.json</files>
  <action>
    Run shadcn CLI to add dropdown-menu, avatar, and separator components:
    ```bash
    cd web && npx shadcn@latest add dropdown-menu avatar separator -y
    ```

    These are needed for UserDropdown and Sidebar components.

    If shadcn creates files in wrong directory (@/), move them to src/components/ui/ as done in 07-03.
  </action>
  <verify>ls web/src/components/ui/ shows dropdown-menu.tsx, avatar.tsx, separator.tsx</verify>
  <done>shadcn components installed in correct location</done>
</task>

<task type="auto">
  <name>Task 2: Create MainLayout, Sidebar, and Header components</name>
  <files>web/src/components/layout/MainLayout.tsx, web/src/components/layout/Sidebar.tsx, web/src/components/layout/Header.tsx, web/src/components/layout/index.ts</files>
  <action>
    Create layout folder structure with:

    **MainLayout.tsx:**
    - Wrapper component that renders sidebar + header + content
    - Use grid layout: sidebar fixed width (240px), content fills remaining
    - Pass children to content area
    - Mobile: sidebar hidden by default, hamburger menu in header
    - Use useState for mobile sidebar open/close

    **Sidebar.tsx:**
    - Fixed sidebar with app logo at top
    - Navigation links using NavLink from react-router-dom (active state styling)
    - Links for: Dashboard, Upload (Phase 09), Analyses (Phase 10), Reports (Phase 12)
    - Use Lucide icons: LayoutDashboard, Upload, FileSearch, FileText
    - Active link: bg-accent text-accent-foreground
    - Mobile: overlay sidebar with backdrop

    **Header.tsx:**
    - Sticky header with hamburger menu (mobile only), breadcrumbs, and user dropdown
    - Use flexbox: hamburger left, breadcrumbs center, user dropdown right
    - Import UserDropdown and Breadcrumbs (create in next task)

    **index.ts:**
    - Barrel export: MainLayout, Sidebar, Header

    Use Tailwind classes consistent with shadcn/ui design system.
    Import cn() from @/lib/utils for conditional classes.
  </action>
  <verify>tsc --noEmit in web directory passes (no TypeScript errors)</verify>
  <done>Layout components created with proper structure and styling</done>
</task>

<task type="auto">
  <name>Task 3: Create UserDropdown and Breadcrumbs components</name>
  <files>web/src/components/layout/UserDropdown.tsx, web/src/components/layout/Breadcrumbs.tsx, web/src/components/layout/index.ts</files>
  <action>
    **UserDropdown.tsx:**
    - Use shadcn DropdownMenu component
    - Trigger: Avatar with user initial or fallback icon
    - Content:
      - User email (disabled item, just display)
      - Separator
      - Logout button with LogOut icon
    - Call logout() from useAuth hook on logout click
    - Style: subtle hover states, proper spacing

    **Breadcrumbs.tsx:**
    - Use useLocation() from react-router-dom to get current path
    - Parse pathname into segments (e.g., /dashboard/analysis/123 -> ["dashboard", "analysis", "123"])
    - Map segments to labels (capitalize, handle special cases)
    - Render as: Home / Dashboard / Analysis
    - Use ChevronRight icon as separator
    - Last item is current page (not a link)
    - Earlier items are links to their paths
    - Handle edge cases: root path shows just "Home"

    Update index.ts to export UserDropdown and Breadcrumbs.
  </action>
  <verify>tsc --noEmit passes, components exported from layout/index.ts</verify>
  <done>UserDropdown shows user menu with logout, Breadcrumbs shows navigation path</done>
</task>

<task type="auto">
  <name>Task 4: Integrate MainLayout into App routes</name>
  <files>web/src/App.tsx, web/src/pages/DashboardPage.tsx</files>
  <action>
    **App.tsx:**
    - Import MainLayout from @/components/layout
    - Wrap protected routes with MainLayout:
      ```tsx
      <Route
        path="/dashboard"
        element={
          <ProtectedRoute>
            <MainLayout>
              <DashboardPage />
            </MainLayout>
          </ProtectedRoute>
        }
      />
      ```
    - Keep login route outside MainLayout (no sidebar/header for login)

    **DashboardPage.tsx:**
    - Remove the inline header and layout wrapper (now handled by MainLayout)
    - Keep only the main content (welcome card)
    - Remove imports for Button, LogOut that were used in old header
    - Component should just render the page content

    This establishes the pattern: protected routes use MainLayout, public routes don't.
  </action>
  <verify>npm run dev starts successfully, navigating to /dashboard shows sidebar + header + content</verify>
  <done>MainLayout wraps protected routes, DashboardPage renders inside layout</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] `cd web && npx tsc --noEmit` shows no TypeScript errors
- [ ] Running `npm run dev` and visiting /dashboard shows:
  - Sidebar on left with navigation links
  - Header on top with breadcrumbs and user dropdown
  - Dashboard content in main area
- [ ] Clicking user dropdown shows email and logout option
- [ ] Clicking logout logs user out and redirects to login
- [ ] Breadcrumbs show "Home / Dashboard" on dashboard page
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Layout structure matches standard SaaS app shell
- No TypeScript or build errors
- Navigation links styled correctly (active state)
</success_criteria>

<output>
After completion, create `.planning/phases/08-layout-components/08-01-SUMMARY.md`
</output>
