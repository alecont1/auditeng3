---
phase: 11-details-review
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/types/analysis.ts
  - web/src/services/analysis.ts
  - web/src/hooks/useAnalysis.ts
  - web/src/hooks/index.ts
  - web/src/components/analysis/AnalysisHeader.tsx
  - web/src/components/analysis/VerdictCard.tsx
  - web/src/components/analysis/ConfidenceIndicator.tsx
  - web/src/components/analysis/index.ts
  - web/src/pages/AnalysisDetailsPage.tsx
  - web/src/pages/index.ts
  - web/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to /analyses/:id from dashboard table row"
    - "User sees analysis metadata (equipment_tag, test_type, equipment_type)"
    - "User sees verdict with color-coded visual"
    - "User sees compliance score as percentage with color"
    - "User sees confidence score indicator"
  artifacts:
    - path: "web/src/pages/AnalysisDetailsPage.tsx"
      provides: "Analysis details page with header, verdict, confidence"
      min_lines: 50
    - path: "web/src/hooks/useAnalysis.ts"
      provides: "TanStack Query hook for single analysis"
      exports: ["useAnalysis"]
    - path: "web/src/services/analysis.ts"
      provides: "getAnalysis service function"
    - path: "web/src/types/analysis.ts"
      provides: "AnalysisDetail, FindingDetail types"
  key_links:
    - from: "AnalysisDetailsPage.tsx"
      to: "useAnalysis hook"
      via: "const { data } = useAnalysis(id)"
      pattern: "useAnalysis\\("
    - from: "useAnalysis.ts"
      to: "/api/analyses/:id"
      via: "getAnalysis service call"
      pattern: "getAnalysis"
    - from: "App.tsx"
      to: "AnalysisDetailsPage"
      via: "Route path=/analyses/:id"
      pattern: "path.*analyses.*:id"
---

<objective>
Create the Analysis Details page with metadata header, verdict display, and confidence indicator.

Purpose: Allow engineers to view complete analysis information before reviewing and making approve/reject decisions.
Output: AnalysisDetailsPage with header, verdict card, and confidence indicator. Navigation from dashboard to details.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v2.0-ROADMAP.md
@.planning/STATE.md

# Prior work
@.planning/phases/10-dashboard/10-01-SUMMARY.md
@.planning/phases/10-dashboard/10-02-SUMMARY.md

# Existing code
@web/src/types/analysis.ts
@web/src/services/analysis.ts
@web/src/hooks/index.ts
@web/src/pages/DashboardPage.tsx
@web/src/components/analysis/StatusBadge.tsx
@web/src/components/analysis/VerdictBadge.tsx
@web/src/App.tsx

# Backend API schema (for response types)
@app/api/schemas.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add analysis detail types and service</name>
  <files>web/src/types/analysis.ts, web/src/services/analysis.ts</files>
  <action>
    1. In types/analysis.ts, add types matching backend AnalysisResponse schema:
       - FindingEvidence: { extracted_value: any, threshold: any, standard_reference: string }
       - FindingDetail: { rule_id, severity, message, field_path?, evidence?, remediation? }
       - AnalysisDetail: { id, equipment_type, test_type, equipment_tag?, verdict?, compliance_score?, confidence_score?, findings: FindingDetail[], extraction_result?, created_at }

    2. In services/analysis.ts, add getAnalysis function:
       - Accepts analysisId: string
       - GET /api/analyses/{analysisId}
       - Returns AnalysisDetail
       - Handle 202 status (still processing) by returning null or throwing specific error
  </action>
  <verify>TypeScript compiles: cd web && npx tsc --noEmit</verify>
  <done>Types match backend schema, getAnalysis service function works</done>
</task>

<task type="auto">
  <name>Task 2: Create useAnalysis hook and detail components</name>
  <files>web/src/hooks/useAnalysis.ts, web/src/hooks/index.ts, web/src/components/analysis/AnalysisHeader.tsx, web/src/components/analysis/VerdictCard.tsx, web/src/components/analysis/ConfidenceIndicator.tsx, web/src/components/analysis/index.ts</files>
  <action>
    1. Create useAnalysis.ts hook:
       - Use TanStack Query useQuery
       - Query key: ['analysis', analysisId]
       - Call getAnalysis service
       - Enable refetch on 202 (analysis processing)
       - Return { data, isLoading, isError, error }

    2. Create AnalysisHeader.tsx:
       - Props: equipment_tag, test_type, equipment_type, created_at
       - Display equipment tag prominently (h1 or large text)
       - Show test type and equipment type as badges or labels
       - Show created date formatted
       - Back button/link to dashboard

    3. Create VerdictCard.tsx:
       - Props: verdict (approved/review/rejected), compliance_score
       - Large verdict badge (reuse VerdictBadge or create larger variant)
       - Compliance score as progress bar or circular indicator
       - Color coded: >=90% green, >=70% amber, <70% red
       - Card layout using shadcn Card component

    4. Create ConfidenceIndicator.tsx:
       - Props: confidence_score (0-1)
       - Display as percentage with visual indicator
       - Low (<0.7) = warning color, Medium (0.7-0.85) = amber, High (>0.85) = green
       - Tooltip explaining what confidence means

    5. Export all from index.ts
  </action>
  <verify>cd web && npm run build</verify>
  <done>Hook fetches analysis, header shows metadata, verdict card shows score, confidence indicator works</done>
</task>

<task type="auto">
  <name>Task 3: Create AnalysisDetailsPage and add routing</name>
  <files>web/src/pages/AnalysisDetailsPage.tsx, web/src/pages/index.ts, web/src/App.tsx, web/src/components/analysis/AnalysisTable.tsx</files>
  <action>
    1. Create AnalysisDetailsPage.tsx:
       - Get analysisId from useParams
       - Use useAnalysis hook to fetch data
       - Layout:
         - AnalysisHeader at top
         - Two-column layout (or stacked on mobile):
           - Left: VerdictCard + ConfidenceIndicator
           - Right: Placeholder div for findings (11-02) and review actions (11-03)
       - Loading state: Skeleton for header and cards
       - Error state: Alert with retry button
       - 202 processing state: Show processing indicator with auto-refresh

    2. Add route in App.tsx:
       - Protected route: /analyses/:id
       - Use AnalysisDetailsPage component

    3. Make table rows clickable in AnalysisTable.tsx:
       - Wrap row or add onClick to navigate to /analyses/{id}
       - Use useNavigate from react-router-dom
       - Add hover state styling (cursor-pointer)

    4. Export AnalysisDetailsPage from pages/index.ts
  </action>
  <verify>cd web && npm run build && npm run dev (manually test navigation)</verify>
  <done>Details page loads at /analyses/:id, clicking dashboard row navigates to details</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] Types match backend AnalysisResponse schema
- [ ] useAnalysis hook fetches single analysis
- [ ] AnalysisHeader displays all metadata
- [ ] VerdictCard shows verdict and compliance score with colors
- [ ] ConfidenceIndicator shows extraction confidence
- [ ] Route /analyses/:id works
- [ ] Clicking dashboard table row navigates to details
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- User can navigate from dashboard to analysis details
- Analysis metadata, verdict, and confidence display correctly
</success_criteria>

<output>
After completion, create `.planning/phases/11-details-review/11-01-SUMMARY.md`
</output>
