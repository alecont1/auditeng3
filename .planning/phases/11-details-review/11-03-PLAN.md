---
phase: 11-details-review
plan: 03
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - web/src/services/analysis.ts
  - web/src/hooks/useApproveAnalysis.ts
  - web/src/hooks/useRejectAnalysis.ts
  - web/src/hooks/index.ts
  - web/src/components/analysis/ApproveButton.tsx
  - web/src/components/analysis/RejectDialog.tsx
  - web/src/components/analysis/ReviewActions.tsx
  - web/src/components/analysis/index.ts
  - web/src/components/ui/dialog.tsx
  - web/src/components/ui/textarea.tsx
  - web/src/pages/AnalysisDetailsPage.tsx
autonomous: true

must_haves:
  truths:
    - "User sees Approve button for analyses needing review"
    - "User sees Reject button with reason input"
    - "Clicking Approve shows confirmation before submitting"
    - "Clicking Reject opens dialog for reason input"
    - "User sees success toast after approve/reject"
    - "Page refreshes data after successful action"
  artifacts:
    - path: "web/src/components/analysis/ReviewActions.tsx"
      provides: "Approve/Reject button group"
      min_lines: 30
    - path: "web/src/components/analysis/RejectDialog.tsx"
      provides: "Dialog with reason textarea"
      min_lines: 40
    - path: "web/src/hooks/useApproveAnalysis.ts"
      provides: "Mutation hook for approve action"
      exports: ["useApproveAnalysis"]
    - path: "web/src/hooks/useRejectAnalysis.ts"
      provides: "Mutation hook for reject action"
      exports: ["useRejectAnalysis"]
  key_links:
    - from: "ReviewActions.tsx"
      to: "useApproveAnalysis"
      via: "Mutation on approve click"
      pattern: "useApproveAnalysis\\("
    - from: "ReviewActions.tsx"
      to: "RejectDialog"
      via: "Opens dialog on reject click"
      pattern: "<RejectDialog"
    - from: "useApproveAnalysis.ts"
      to: "/api/analyses/:id/approve"
      via: "PUT request"
      pattern: "approveAnalysis"
---

<objective>
Create review action components for approve/reject workflow.

Purpose: Allow engineers to approve or reject analyses with one click, completing the review workflow.
Output: ReviewActions component with ApproveButton, RejectDialog, and mutation hooks. Integrated into AnalysisDetailsPage.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v2.0-ROADMAP.md
@.planning/STATE.md

# Prior work
@.planning/phases/11-details-review/11-01-SUMMARY.md

# Existing code
@web/src/types/analysis.ts
@web/src/services/analysis.ts
@web/src/hooks/index.ts
@web/src/pages/AnalysisDetailsPage.tsx
@web/src/components/ui/button.tsx
@web/src/components/ui/card.tsx
@web/src/lib/api.ts

# Backend API reference (endpoints to be created in Phase 13)
# PUT /api/analyses/{id}/approve
# PUT /api/analyses/{id}/reject (body: { reason: string })
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shadcn Dialog and Textarea, create service functions</name>
  <files>web/src/components/ui/dialog.tsx, web/src/components/ui/textarea.tsx, web/src/services/analysis.ts</files>
  <action>
    1. Add shadcn Dialog component:
       - Run: cd web && npx shadcn@latest add dialog
       - If CLI puts in wrong location, move to src/components/ui/

    2. Add shadcn Textarea component:
       - Run: cd web && npx shadcn@latest add textarea
       - If CLI puts in wrong location, move to src/components/ui/

    3. In services/analysis.ts, add approve/reject functions:
       - approveAnalysis(analysisId: string): Promise<void>
         - PUT /api/analyses/{analysisId}/approve
         - Returns void (or analysis object if backend returns it)
       - rejectAnalysis(analysisId: string, reason: string): Promise<void>
         - PUT /api/analyses/{analysisId}/reject
         - Body: { reason }
         - Returns void

    Note: These endpoints don't exist yet (Phase 13). The service functions are ready for when backend is implemented.
  </action>
  <verify>cd web && npx tsc --noEmit</verify>
  <done>Dialog and Textarea components exist, service functions ready for backend endpoints</done>
</task>

<task type="auto">
  <name>Task 2: Create mutation hooks and review UI components</name>
  <files>web/src/hooks/useApproveAnalysis.ts, web/src/hooks/useRejectAnalysis.ts, web/src/hooks/index.ts, web/src/components/analysis/ApproveButton.tsx, web/src/components/analysis/RejectDialog.tsx, web/src/components/analysis/ReviewActions.tsx, web/src/components/analysis/index.ts</files>
  <action>
    1. Create useApproveAnalysis.ts:
       - Use TanStack Query useMutation
       - Call approveAnalysis service
       - On success:
         - Show success toast "Analysis approved"
         - Invalidate ['analysis', analysisId] query
         - Invalidate ['analyses'] query (dashboard list)
       - On error: Show error toast

    2. Create useRejectAnalysis.ts:
       - Use TanStack Query useMutation
       - Call rejectAnalysis service with reason
       - On success:
         - Show success toast "Analysis rejected"
         - Invalidate queries
       - On error: Show error toast

    3. Create ApproveButton.tsx:
       - Props: analysisId, disabled?, onSuccess?
       - Green/success styled button with checkmark icon
       - Confirm dialog before submitting:
         - "Approve this analysis?"
         - "This will mark the analysis as approved and cannot be undone."
         - Cancel / Confirm buttons
       - Loading state during mutation
       - Uses useApproveAnalysis hook

    4. Create RejectDialog.tsx:
       - Props: analysisId, open, onOpenChange, onSuccess?
       - Dialog with:
         - Title: "Reject Analysis"
         - Description: "Please provide a reason for rejection"
         - Textarea for reason (required, min 10 chars)
         - Cancel / Reject buttons
       - Reject button disabled until reason is valid
       - Loading state during mutation
       - Uses useRejectAnalysis hook
       - Closes dialog on success

    5. Create ReviewActions.tsx:
       - Props: analysisId, currentVerdict
       - Only show when verdict is 'review' or 'NEEDS_REVIEW'
       - Layout: Approve button (prominent) + Reject button (outline/secondary)
       - If already approved/rejected, show status instead of buttons
       - Uses ApproveButton and RejectDialog internally

    6. Export all from index.ts
  </action>
  <verify>cd web && npm run build</verify>
  <done>Hooks handle mutations, ApproveButton shows confirm dialog, RejectDialog captures reason</done>
</task>

<task type="auto">
  <name>Task 3: Integrate ReviewActions into AnalysisDetailsPage</name>
  <files>web/src/pages/AnalysisDetailsPage.tsx</files>
  <action>
    1. Import ReviewActions component

    2. Add ReviewActions to page layout:
       - Position below AnalysisHeader or in the verdict/confidence section
       - Pass analysisId and currentVerdict
       - Only visible when analysis is loaded

    3. Ensure proper layout:
       - Actions should be visually prominent
       - Consider sticky positioning or fixed at bottom on mobile
       - Clear visual hierarchy: verdict info > actions > findings

    4. Handle post-action state:
       - After approve/reject, analysis data will refetch
       - ReviewActions will update to show new verdict status
  </action>
  <verify>cd web && npm run build && npm run dev (manually verify UI)</verify>
  <done>ReviewActions visible on details page, approve/reject workflow functional (pending backend)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] Dialog and Textarea components from shadcn exist
- [ ] approveAnalysis and rejectAnalysis service functions exist
- [ ] useApproveAnalysis and useRejectAnalysis hooks work
- [ ] ApproveButton shows confirmation dialog
- [ ] RejectDialog requires reason input
- [ ] ReviewActions shows buttons only for 'review' verdict
- [ ] ReviewActions integrated into AnalysisDetailsPage
- [ ] Toast notifications configured for success/error
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Review workflow UI complete and ready for backend
- Approve shows confirmation, Reject captures reason
- UI gracefully handles 404 until Phase 13 backend is ready
</success_criteria>

<output>
After completion, create `.planning/phases/11-details-review/11-03-SUMMARY.md`
</output>
