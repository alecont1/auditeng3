---
phase: 09-upload
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/pages/UploadPage.tsx
  - web/src/pages/index.ts
  - web/src/components/upload/FileDropzone.tsx
  - web/src/components/upload/FilePreview.tsx
  - web/src/components/upload/index.ts
  - web/src/lib/file-utils.ts
  - web/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can drag and drop a file onto the upload zone"
    - "User can click to open file picker as alternative"
    - "User sees file preview before submitting"
    - "User sees validation error for invalid file type or size"
    - "Upload page is accessible from sidebar navigation"
  artifacts:
    - path: "web/src/pages/UploadPage.tsx"
      provides: "Upload page with dropzone and preview"
      min_lines: 50
    - path: "web/src/components/upload/FileDropzone.tsx"
      provides: "Drag-and-drop file input zone"
      min_lines: 40
      contains: "onDrop"
    - path: "web/src/components/upload/FilePreview.tsx"
      provides: "File preview with name, size, type"
      min_lines: 20
    - path: "web/src/lib/file-utils.ts"
      provides: "File validation utilities"
      contains: "validateFile"
  key_links:
    - from: "web/src/App.tsx"
      to: "web/src/pages/UploadPage.tsx"
      via: "Route definition for /upload"
      pattern: 'path="/upload"'
    - from: "web/src/components/upload/FileDropzone.tsx"
      to: "web/src/lib/file-utils.ts"
      via: "Import validateFile"
      pattern: "validateFile"
---

<objective>
Create the upload interface with drag-and-drop file input and file preview.

Purpose: Allow users to select and preview documents before uploading for analysis.
Output: UploadPage with FileDropzone component and file preview, accessible from sidebar.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v2.0-ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-layout-components/08-01-SUMMARY.md

# Existing files:
@web/src/App.tsx
@web/src/lib/api.ts
@web/src/components/layout/MainLayout.tsx
@web/src/components/ui/button.tsx
@web/src/components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create file validation utilities</name>
  <files>web/src/lib/file-utils.ts</files>
  <action>
    Create file validation utilities:

    ```typescript
    // Allowed file types for upload
    export const ALLOWED_TYPES = [
      'application/pdf',
      'image/jpeg',
      'image/png',
      'image/webp',
    ]

    // Max file size: 50MB
    export const MAX_FILE_SIZE = 50 * 1024 * 1024

    export interface FileValidationResult {
      valid: boolean
      error?: string
    }

    export function validateFile(file: File): FileValidationResult {
      if (!ALLOWED_TYPES.includes(file.type)) {
        return {
          valid: false,
          error: `Invalid file type. Allowed: PDF, JPEG, PNG, WebP`,
        }
      }

      if (file.size > MAX_FILE_SIZE) {
        return {
          valid: false,
          error: `File too large. Maximum size is 50MB`,
        }
      }

      return { valid: true }
    }

    export function formatFileSize(bytes: number): string {
      if (bytes < 1024) return `${bytes} B`
      if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`
      return `${(bytes / (1024 * 1024)).toFixed(1)} MB`
    }

    export function getFileTypeLabel(type: string): string {
      const typeMap: Record<string, string> = {
        'application/pdf': 'PDF',
        'image/jpeg': 'JPEG',
        'image/png': 'PNG',
        'image/webp': 'WebP',
      }
      return typeMap[type] || type
    }
    ```
  </action>
  <verify>tsc --noEmit passes</verify>
  <done>File validation utilities created with type checking, size checking, formatters</done>
</task>

<task type="auto">
  <name>Task 2: Create FileDropzone component</name>
  <files>web/src/components/upload/FileDropzone.tsx, web/src/components/upload/index.ts</files>
  <action>
    Create FileDropzone component with drag-and-drop support:

    **FileDropzone.tsx:**
    - Uses native drag and drop events (no external library needed)
    - Props: onFileSelect(file: File), disabled?: boolean
    - Visual states: default, drag-over (highlighted), disabled
    - Hidden file input triggered by click
    - Accept attribute for allowed types
    - Validates file on drop/select using validateFile
    - Shows error toast on invalid file

    Structure:
    ```tsx
    interface FileDropzoneProps {
      onFileSelect: (file: File) => void
      disabled?: boolean
    }

    export function FileDropzone({ onFileSelect, disabled }: FileDropzoneProps) {
      const [isDragOver, setIsDragOver] = useState(false)
      const inputRef = useRef<HTMLInputElement>(null)

      const handleDrop = (e: DragEvent) => {
        e.preventDefault()
        setIsDragOver(false)
        const file = e.dataTransfer?.files[0]
        if (file) handleFile(file)
      }

      const handleFile = (file: File) => {
        const result = validateFile(file)
        if (!result.valid) {
          toast.error(result.error)
          return
        }
        onFileSelect(file)
      }

      // ... drag handlers, click handler, render
    }
    ```

    Styling:
    - Default: dashed border, muted background
    - Drag over: solid border, accent color, subtle scale
    - Disabled: opacity reduced, cursor not-allowed
    - Icon: Upload icon from lucide-react
    - Text: "Drag and drop your file here" + "or click to browse"

    **index.ts:**
    - Barrel export: FileDropzone, FilePreview (for next task)
  </action>
  <verify>tsc --noEmit passes, component can be imported</verify>
  <done>FileDropzone handles drag-drop, click, validation with proper visual feedback</done>
</task>

<task type="auto">
  <name>Task 3: Create FilePreview component</name>
  <files>web/src/components/upload/FilePreview.tsx, web/src/components/upload/index.ts</files>
  <action>
    Create FilePreview component to show selected file:

    **FilePreview.tsx:**
    ```tsx
    interface FilePreviewProps {
      file: File
      onRemove: () => void
    }

    export function FilePreview({ file, onRemove }: FilePreviewProps) {
      // Show:
      // - File icon (FileText for PDF, Image for images)
      // - File name (truncated if long)
      // - File size (formatted)
      // - File type label
      // - Remove button (X icon)
    }
    ```

    Layout:
    - Card with flex row
    - Icon on left (48x48)
    - File info in middle (name, size, type)
    - Remove button on right

    Use formatFileSize and getFileTypeLabel from file-utils.

    Update index.ts to export FilePreview.
  </action>
  <verify>tsc --noEmit passes</verify>
  <done>FilePreview shows file details with remove option</done>
</task>

<task type="auto">
  <name>Task 4: Create UploadPage and add route</name>
  <files>web/src/pages/UploadPage.tsx, web/src/pages/index.ts, web/src/App.tsx</files>
  <action>
    **UploadPage.tsx:**
    ```tsx
    export function UploadPage() {
      const [selectedFile, setSelectedFile] = useState<File | null>(null)

      return (
        <div className="space-y-6">
          <div>
            <h1 className="text-2xl font-bold">Upload Document</h1>
            <p className="text-muted-foreground">
              Upload a PDF or image for automated analysis
            </p>
          </div>

          {!selectedFile ? (
            <FileDropzone onFileSelect={setSelectedFile} />
          ) : (
            <div className="space-y-4">
              <FilePreview file={selectedFile} onRemove={() => setSelectedFile(null)} />
              <Button className="w-full" size="lg">
                Start Analysis
              </Button>
            </div>
          )}

          {/* Info card about supported files */}
          <Card className="p-4">
            <h3 className="font-medium mb-2">Supported files</h3>
            <ul className="text-sm text-muted-foreground space-y-1">
              <li>PDF documents (up to 50MB)</li>
              <li>Images: JPEG, PNG, WebP</li>
            </ul>
          </Card>
        </div>
      )
    }
    ```

    **pages/index.ts:**
    - Add UploadPage to barrel exports

    **App.tsx:**
    - Add route for /upload inside MainLayout:
    ```tsx
    <Route
      path="/upload"
      element={
        <ProtectedRoute>
          <MainLayout>
            <UploadPage />
          </MainLayout>
        </ProtectedRoute>
      }
    />
    ```

    The "Start Analysis" button will be wired up in 09-02 (just a placeholder for now).
  </action>
  <verify>npm run dev, navigate to /upload shows dropzone, select file shows preview</verify>
  <done>UploadPage renders with dropzone, preview, and info card. Route accessible at /upload</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] `cd web && npx tsc --noEmit` shows no TypeScript errors
- [ ] Navigate to /upload shows upload page
- [ ] Drag and drop a PDF shows preview
- [ ] Click dropzone opens file picker
- [ ] Invalid file type shows toast error
- [ ] File > 50MB shows toast error
- [ ] Remove button clears selected file
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Upload interface matches design spec
- No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-upload/09-01-SUMMARY.md`
</output>
