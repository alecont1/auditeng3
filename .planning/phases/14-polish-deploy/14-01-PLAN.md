---
phase: 14-polish-deploy
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/package.json
  - web/vitest.config.ts
  - web/src/test/setup.ts
  - web/src/components/analysis/StatusBadge.test.tsx
  - web/src/components/analysis/VerdictBadge.test.tsx
  - web/src/components/analysis/SeverityBadge.test.tsx
  - web/src/hooks/useAuth.test.tsx
autonomous: true

must_haves:
  truths:
    - "npm run test command exists and runs Vitest"
    - "Badge components render correct labels for each status"
    - "useAuth throws error when used outside provider"
  artifacts:
    - path: "web/vitest.config.ts"
      provides: "Vitest configuration with jsdom"
      contains: "jsdom"
    - path: "web/src/test/setup.ts"
      provides: "Test setup with cleanup"
    - path: "web/src/components/analysis/StatusBadge.test.tsx"
      provides: "StatusBadge component tests"
      min_lines: 20
    - path: "web/src/hooks/useAuth.test.tsx"
      provides: "useAuth hook tests"
      min_lines: 15
  key_links:
    - from: "vitest.config.ts"
      to: "src/test/setup.ts"
      via: "setupFiles"
      pattern: "setupFiles.*setup"
---

<objective>
Set up Vitest test framework and write tests for critical components and hooks.

Purpose: Establish testing infrastructure and verify core UI components and hooks work correctly.
Output: Working test suite with 10+ tests covering badges and auth hook.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@web/package.json
@web/vite.config.ts
@web/src/components/analysis/StatusBadge.tsx
@web/src/components/analysis/VerdictBadge.tsx
@web/src/components/analysis/SeverityBadge.tsx
@web/src/hooks/useAuth.ts
@web/src/contexts/AuthContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Vitest and configure test environment</name>
  <files>web/package.json, web/vitest.config.ts, web/src/test/setup.ts</files>
  <action>
    1. Install test dependencies:
       - vitest
       - @testing-library/react
       - @testing-library/jest-dom
       - @testing-library/user-event
       - jsdom

    2. Create vitest.config.ts:
       - Use jsdom environment
       - Set setupFiles to src/test/setup.ts
       - Configure path alias @ to match vite.config.ts
       - Include coverage reporter (v8)

    3. Create src/test/setup.ts:
       - Import @testing-library/jest-dom
       - Add cleanup after each test

    4. Add scripts to package.json:
       - "test": "vitest"
       - "test:run": "vitest run"
       - "test:coverage": "vitest run --coverage"
  </action>
  <verify>Run `npm run test:run` in web/ - should pass with 0 tests</verify>
  <done>Vitest configured, npm run test works</done>
</task>

<task type="auto">
  <name>Task 2: Write tests for Badge components</name>
  <files>web/src/components/analysis/StatusBadge.test.tsx, web/src/components/analysis/VerdictBadge.test.tsx, web/src/components/analysis/SeverityBadge.test.tsx</files>
  <action>
    For StatusBadge.test.tsx:
    - Test renders "Pending" with amber styling for status="pending"
    - Test renders "Completed" with green styling for status="completed"
    - Test renders "Failed" with red styling for status="failed"
    - Test applies custom className prop

    For VerdictBadge.test.tsx (read component first to understand verdicts):
    - Test renders each verdict type with correct label and color
    - Test outline variant for needs_review

    For SeverityBadge.test.tsx (read component first to understand severities):
    - Test renders each severity level with correct label
    - Test destructive variant for critical severity

    Use render() from @testing-library/react, screen queries, expect().toBeInTheDocument()
  </action>
  <verify>Run `npm run test:run` in web/ - all badge tests pass</verify>
  <done>9+ tests passing for badge components</done>
</task>

<task type="auto">
  <name>Task 3: Write tests for useAuth hook</name>
  <files>web/src/hooks/useAuth.test.tsx</files>
  <action>
    Test useAuth hook:
    - Test throws error when used outside AuthProvider ("useAuth must be used within an AuthProvider")
    - Test returns context value when used inside AuthProvider

    To test hooks, use renderHook from @testing-library/react.
    Need to create mock AuthProvider wrapper for positive tests.

    Example structure:
    ```tsx
    import { renderHook } from '@testing-library/react'
    import { useAuth } from './useAuth'
    import { AuthProvider } from '@/contexts/AuthContext'

    describe('useAuth', () => {
      it('throws error when used outside AuthProvider', () => {
        expect(() => renderHook(() => useAuth())).toThrow(
          'useAuth must be used within an AuthProvider'
        )
      })

      it('returns context when used inside AuthProvider', () => {
        const wrapper = ({ children }) => <AuthProvider>{children}</AuthProvider>
        const { result } = renderHook(() => useAuth(), { wrapper })
        expect(result.current).toBeDefined()
      })
    })
    ```
  </action>
  <verify>Run `npm run test:run` in web/ - all tests pass including useAuth tests</verify>
  <done>All tests pass (12+ total)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all tests
- [ ] vitest.config.ts exists with jsdom environment
- [ ] src/test/setup.ts exists with jest-dom import
- [ ] Badge tests cover all status/verdict/severity values
- [ ] useAuth test verifies error throwing behavior
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- 12+ tests passing
- No TypeScript errors in test files
</success_criteria>

<output>
After completion, create `.planning/phases/14-polish-deploy/14-01-SUMMARY.md`
</output>
