---
phase: 10-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/types/analysis.ts
  - web/src/services/analysis.ts
  - web/src/hooks/useAnalyses.ts
  - web/src/hooks/index.ts
  - web/src/components/analysis/StatusBadge.tsx
  - web/src/components/analysis/VerdictBadge.tsx
  - web/src/components/analysis/AnalysisTable.tsx
  - web/src/components/analysis/AnalysisTableSkeleton.tsx
  - web/src/components/analysis/index.ts
  - web/src/pages/DashboardPage.tsx
  - web/src/components/ui/badge.tsx
  - web/src/components/ui/table.tsx
  - web/src/components/ui/skeleton.tsx
autonomous: true

must_haves:
  truths:
    - "User can see a list of their analyses on the dashboard"
    - "Each analysis shows equipment tag, test type, status, verdict, and scores"
    - "Status badges are color-coded (pending=yellow, completed=green, failed=red)"
    - "Verdict badges distinguish approved/rejected/needs_review"
    - "Pagination controls allow navigating through results"
    - "Loading state shows skeleton while fetching"
    - "Empty state shows when no analyses exist"
  artifacts:
    - path: "web/src/services/analysis.ts"
      provides: "getAnalyses function for fetching paginated list"
      contains: "getAnalyses"
    - path: "web/src/hooks/useAnalyses.ts"
      provides: "TanStack Query hook for analysis list"
      exports: ["useAnalyses"]
    - path: "web/src/components/analysis/AnalysisTable.tsx"
      provides: "Table displaying analyses with pagination"
      min_lines: 50
    - path: "web/src/pages/DashboardPage.tsx"
      provides: "Dashboard showing analysis list"
      contains: "useAnalyses"
  key_links:
    - from: "DashboardPage.tsx"
      to: "useAnalyses"
      via: "hook import and call"
      pattern: "useAnalyses\\("
    - from: "useAnalyses.ts"
      to: "services/analysis"
      via: "getAnalyses import"
      pattern: "getAnalyses"
    - from: "AnalysisTable.tsx"
      to: "StatusBadge, VerdictBadge"
      via: "component imports"
      pattern: "StatusBadge|VerdictBadge"
---

<objective>
Create the analysis list view with table, status/verdict badges, pagination, and skeleton loading.

Purpose: Enable users to see their analysis history in a structured table with visual status indicators.
Output: DashboardPage showing AnalysisTable with pagination and loading states.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v2.0-ROADMAP.md
@.planning/STATE.md

# Prior phase context (established patterns)
@.planning/phases/09-upload/09-02-SUMMARY.md

# Existing source files
@web/src/types/analysis.ts
@web/src/services/analysis.ts
@web/src/hooks/index.ts
@web/src/pages/DashboardPage.tsx
@web/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add analysis list types and service</name>
  <files>web/src/types/analysis.ts, web/src/services/analysis.ts</files>
  <action>
    **In web/src/types/analysis.ts:**
    Add types for list endpoint:
    ```typescript
    // Pagination meta from backend
    export interface PaginationMeta {
      page: number
      per_page: number
      total: number
      total_pages: number
    }

    // Query params for list endpoint
    export interface ListAnalysesParams {
      page?: number
      per_page?: number
      status?: 'pending' | 'completed' | 'failed'
      date_from?: string
      date_to?: string
      sort_by?: 'created_at' | 'compliance_score'
      sort_order?: 'asc' | 'desc'
    }

    // Response from GET /api/analyses
    export interface ListAnalysesResponse {
      items: AnalysisSummary[]
      meta: PaginationMeta
    }
    ```

    **In web/src/services/analysis.ts:**
    Add getAnalyses function:
    ```typescript
    export async function getAnalyses(
      params: ListAnalysesParams = {}
    ): Promise<ListAnalysesResponse> {
      const response = await api.get<ListAnalysesResponse>('/analyses', { params })
      return response.data
    }
    ```

    Update imports in services file to include new types.
  </action>
  <verify>TypeScript compiles without errors: cd web && npx tsc --noEmit</verify>
  <done>ListAnalysesParams, ListAnalysesResponse types exist; getAnalyses service function exists</done>
</task>

<task type="auto">
  <name>Task 2: Create useAnalyses hook and badge components</name>
  <files>web/src/hooks/useAnalyses.ts, web/src/hooks/index.ts, web/src/components/analysis/StatusBadge.tsx, web/src/components/analysis/VerdictBadge.tsx, web/src/components/analysis/index.ts, web/src/components/ui/badge.tsx</files>
  <action>
    **Add shadcn badge component:**
    Run: npx shadcn@latest add badge
    If it creates in wrong location (@/), move to web/src/components/ui/

    **Create web/src/hooks/useAnalyses.ts:**
    ```typescript
    import { useQuery } from '@tanstack/react-query'
    import { getAnalyses } from '@/services'
    import type { ListAnalysesParams } from '@/types'

    export function useAnalyses(params: ListAnalysesParams = {}) {
      return useQuery({
        queryKey: ['analyses', params],
        queryFn: () => getAnalyses(params),
      })
    }
    ```
    Export from hooks/index.ts

    **Create web/src/components/analysis/StatusBadge.tsx:**
    Badge component that displays task status with color coding:
    - pending: yellow/amber background
    - completed: green background
    - failed: red/destructive background
    Use the Badge component from shadcn with variant prop.

    **Create web/src/components/analysis/VerdictBadge.tsx:**
    Badge for verdict with colors:
    - APPROVED: green outline
    - REJECTED: red outline
    - NEEDS_REVIEW: amber outline
    Use Badge with outline variant and custom colors.

    **Create web/src/components/analysis/index.ts:**
    Barrel export for StatusBadge, VerdictBadge (and later AnalysisTable).
  </action>
  <verify>
    - cd web && npx tsc --noEmit
    - ls web/src/components/ui/badge.tsx
    - ls web/src/components/analysis/
  </verify>
  <done>useAnalyses hook exports from hooks/index.ts; StatusBadge and VerdictBadge components exist with color coding</done>
</task>

<task type="auto">
  <name>Task 3: Create AnalysisTable and update DashboardPage</name>
  <files>web/src/components/analysis/AnalysisTable.tsx, web/src/components/analysis/AnalysisTableSkeleton.tsx, web/src/components/analysis/index.ts, web/src/components/ui/table.tsx, web/src/components/ui/skeleton.tsx, web/src/pages/DashboardPage.tsx</files>
  <action>
    **Add shadcn table and skeleton components:**
    Run: npx shadcn@latest add table skeleton
    Move to correct location if needed.

    **Create web/src/components/analysis/AnalysisTableSkeleton.tsx:**
    Skeleton loading state showing 5 placeholder rows with pulsing animation.
    Use Skeleton component for each cell.

    **Create web/src/components/analysis/AnalysisTable.tsx:**
    Props: { analyses: AnalysisSummary[], isLoading: boolean, page: number, totalPages: number, onPageChange: (page: number) => void }

    Table columns:
    - Equipment Tag (equipment_tag) - clickable link to /analyses/:id
    - Test Type (test_type)
    - Status (StatusBadge)
    - Verdict (VerdictBadge)
    - Compliance (compliance_score as percentage with color)
    - Confidence (confidence_score as percentage)
    - Created (formatted date)

    If isLoading: show AnalysisTableSkeleton
    If empty and not loading: show EmptyState ("No analyses yet", "Upload your first document to get started", link to /upload)

    Pagination: simple prev/next buttons at bottom with page X of Y text.
    Use Button component for pagination controls.

    **Update barrel export** in web/src/components/analysis/index.ts

    **Update web/src/pages/DashboardPage.tsx:**
    - Import useAnalyses hook
    - Add state for page number: const [page, setPage] = useState(1)
    - Call useAnalyses({ page, per_page: 10 })
    - Render AnalysisTable with data, loading state, and pagination
    - Replace placeholder content with actual table
  </action>
  <verify>
    - cd web && npm run build (should succeed)
    - Check DashboardPage imports useAnalyses
  </verify>
  <done>AnalysisTable renders list with StatusBadge, VerdictBadge, pagination; DashboardPage shows AnalysisTable with loading/empty states</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] cd web && npm run build succeeds without errors
- [ ] cd web && npx tsc --noEmit passes
- [ ] DashboardPage imports and uses useAnalyses hook
- [ ] AnalysisTable shows skeleton when loading
- [ ] AnalysisTable shows EmptyState when no data
- [ ] StatusBadge has 3 color variants (pending, completed, failed)
- [ ] VerdictBadge has 3 color variants (approved, rejected, needs_review)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Dashboard shows analysis table (will be empty until backend endpoint exists)
- Loading skeleton displays during data fetch
- Badge components are color-coded correctly
</success_criteria>

<output>
After completion, create `.planning/phases/10-dashboard/10-01-SUMMARY.md`
</output>
