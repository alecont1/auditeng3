---
phase: 10-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - web/src/components/ui/select.tsx
  - web/src/components/ui/popover.tsx
  - web/src/components/ui/calendar.tsx
  - web/src/components/analysis/StatusFilter.tsx
  - web/src/components/analysis/DateRangeFilter.tsx
  - web/src/components/analysis/SortSelect.tsx
  - web/src/components/analysis/QuickStats.tsx
  - web/src/components/analysis/AnalysisFilters.tsx
  - web/src/components/analysis/index.ts
  - web/src/pages/DashboardPage.tsx
  - web/package.json
autonomous: true

must_haves:
  truths:
    - "User can filter analyses by status (all/pending/completed/failed)"
    - "User can filter analyses by date range"
    - "User can sort by date or compliance score"
    - "User sees quick stats: total analyses, pending review, approved today"
    - "Filters update the table results in real-time"
  artifacts:
    - path: "web/src/components/analysis/StatusFilter.tsx"
      provides: "Dropdown to filter by status"
      min_lines: 20
    - path: "web/src/components/analysis/DateRangeFilter.tsx"
      provides: "Date picker for date range filter"
      min_lines: 30
    - path: "web/src/components/analysis/QuickStats.tsx"
      provides: "Stats cards showing totals"
      min_lines: 30
    - path: "web/src/pages/DashboardPage.tsx"
      provides: "Dashboard with filters integrated"
      contains: "StatusFilter"
  key_links:
    - from: "DashboardPage.tsx"
      to: "useAnalyses"
      via: "params include status, date_from, sort_by"
      pattern: "useAnalyses\\(\\{.*status"
    - from: "StatusFilter.tsx"
      to: "onStatusChange callback"
      via: "prop callback"
      pattern: "onStatusChange"
    - from: "QuickStats.tsx"
      to: "analyses data"
      via: "computed from list or separate query"
---

<objective>
Add filtering by status and date range, sorting options, and quick stats cards to the dashboard.

Purpose: Enable users to find specific analyses quickly and see high-level metrics at a glance.
Output: Dashboard with filter controls, sort dropdown, and stats cards above the table.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v2.0-ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase
@.planning/phases/10-dashboard/10-01-SUMMARY.md

# Source files to modify
@web/src/pages/DashboardPage.tsx
@web/src/components/analysis/index.ts
@web/src/types/analysis.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shadcn components and create filter UI</name>
  <files>web/src/components/ui/select.tsx, web/src/components/ui/popover.tsx, web/src/components/ui/calendar.tsx, web/src/components/analysis/StatusFilter.tsx, web/src/components/analysis/DateRangeFilter.tsx, web/src/components/analysis/SortSelect.tsx, web/src/components/analysis/AnalysisFilters.tsx, web/src/components/analysis/index.ts, web/package.json</files>
  <action>
    **Add shadcn components:**
    ```bash
    cd web
    npx shadcn@latest add select popover calendar
    ```
    If created in wrong location (@/), move to web/src/components/ui/

    Calendar requires date-fns, which shadcn should install automatically. If not:
    npm install date-fns

    **Create web/src/components/analysis/StatusFilter.tsx:**
    Props: { value: string | undefined, onChange: (value: string | undefined) => void }

    Select dropdown with options:
    - "All Statuses" (value: undefined/empty)
    - "Pending" (value: "pending")
    - "Completed" (value: "completed")
    - "Failed" (value: "failed")

    Use shadcn Select component.

    **Create web/src/components/analysis/DateRangeFilter.tsx:**
    Props: { dateFrom: string | undefined, dateTo: string | undefined, onChange: (from: string | undefined, to: string | undefined) => void }

    Button that opens a popover with two calendar pickers (From/To).
    Display selected range on button, or "Select dates" if none.
    Use shadcn Popover + Calendar components.
    Format dates as YYYY-MM-DD for API params.

    **Create web/src/components/analysis/SortSelect.tsx:**
    Props: { sortBy: string, sortOrder: 'asc' | 'desc', onChange: (sortBy: string, sortOrder: 'asc' | 'desc') => void }

    Select with combined sort options:
    - "Newest first" (created_at, desc) - default
    - "Oldest first" (created_at, asc)
    - "Highest score" (compliance_score, desc)
    - "Lowest score" (compliance_score, asc)

    **Create web/src/components/analysis/AnalysisFilters.tsx:**
    Wrapper component that contains StatusFilter, DateRangeFilter, and SortSelect in a flex row.
    Props: all filter values and onChange handlers passed through.
    Responsive: stack vertically on mobile, horizontal on desktop.

    **Update barrel export** in web/src/components/analysis/index.ts
  </action>
  <verify>
    - cd web && npx tsc --noEmit
    - ls web/src/components/ui/ | grep -E "select|popover|calendar"
    - ls web/src/components/analysis/
  </verify>
  <done>StatusFilter, DateRangeFilter, SortSelect, and AnalysisFilters components exist with proper props</done>
</task>

<task type="auto">
  <name>Task 2: Create QuickStats and integrate filters into DashboardPage</name>
  <files>web/src/components/analysis/QuickStats.tsx, web/src/components/analysis/index.ts, web/src/pages/DashboardPage.tsx</files>
  <action>
    **Create web/src/components/analysis/QuickStats.tsx:**
    Props: { totalCount: number, pendingCount: number, completedTodayCount: number, isLoading: boolean }

    Three stat cards in a row:
    1. "Total Analyses" - totalCount with icon (FileText or similar)
    2. "Pending Review" - pendingCount with amber color if > 0
    3. "Completed Today" - completedTodayCount with green accent

    Use Card component from shadcn.
    Show Skeleton when isLoading.
    Responsive: 3 columns on desktop, 1 column on mobile.

    For now, compute stats from the current page's data (not ideal but works until backend has stats endpoint):
    - totalCount: from meta.total in the API response
    - pendingCount: filter items where status === 'pending' (approximation from current page)
    - completedTodayCount: filter items where created_at is today and status === 'completed' (approximation)

    Note: These are approximations. In Phase 13 backend can provide accurate stats endpoint.

    **Update web/src/pages/DashboardPage.tsx:**

    Add filter state:
    ```typescript
    const [status, setStatus] = useState<string | undefined>()
    const [dateFrom, setDateFrom] = useState<string | undefined>()
    const [dateTo, setDateTo] = useState<string | undefined>()
    const [sortBy, setSortBy] = useState('created_at')
    const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc')
    ```

    Update useAnalyses call to include filters:
    ```typescript
    const { data, isLoading, isError } = useAnalyses({
      page,
      per_page: 10,
      status: status || undefined,
      date_from: dateFrom,
      date_to: dateTo,
      sort_by: sortBy as 'created_at' | 'compliance_score',
      sort_order: sortOrder,
    })
    ```

    Reset page to 1 when filters change (use useEffect or callback).

    Layout structure:
    ```
    <div>
      <h1>Dashboard</h1>
      <QuickStats ... />
      <AnalysisFilters ... />
      <AnalysisTable ... />
    </div>
    ```

    **Update barrel export** if needed.
  </action>
  <verify>
    - cd web && npm run build
    - grep -n "StatusFilter\|AnalysisFilters" web/src/pages/DashboardPage.tsx
    - grep -n "useAnalyses.*status" web/src/pages/DashboardPage.tsx
  </verify>
  <done>QuickStats shows 3 metrics; DashboardPage has filter controls that update useAnalyses params; page resets to 1 on filter change</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] cd web && npm run build succeeds
- [ ] cd web && npx tsc --noEmit passes
- [ ] StatusFilter dropdown has 4 options (all, pending, completed, failed)
- [ ] DateRangeFilter opens popover with calendars
- [ ] SortSelect has 4 sort options
- [ ] QuickStats displays 3 cards
- [ ] Changing status filter updates useAnalyses params
- [ ] Changing filters resets page to 1
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Dashboard has working filter controls
- Stats cards display (even if approximated from current page data)
- Filters affect the useAnalyses query params
</success_criteria>

<output>
After completion, create `.planning/phases/10-dashboard/10-02-SUMMARY.md`
</output>
